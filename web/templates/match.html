<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="=ie=edge">
        <title>Astro Love</title>
        <link rel="stylesheet" href="/static/css/match.css">
        <link rel="stylesheet" href="/static/css/footer.css">
    </head>
    <body>
        <img src="/static/img/icon_match_neon.png" style="width:40%; display:flex;justify-content: center; margin:10px auto;" />
       <span class="title">МЭТЧИ</span>
        
        <!-- Контейнер вкладок -->
        <div id="tabs" style="display:flex; justify-content:center; flex-wrap: wrap; gap:4px; margin-bottom:15px;"></div>
    
        <!-- Контейнер для матчей -->
        <div id="matches-container" style="margin-bottom: 50px;">
            {% for match in matches %}
                <div class="table-match match-card" id="{{ match.tg_id }}">
                    <div class="match-new">
                        <span class="status">{{ match.status }}</span>
                        <img src="/static/img/match_currency.png" alt="New icon" />
                    </div>
                
                    <div class="match-header">
                        <div class="match-zodiac">
                            <img src="{{ match.partner_sign_path }}" alt="Знак зодиака">
                        </div>
                
                        <div class="match-info">
                            <div class="match-name">{{ match.name }}, {{ match.age }}</div>
                            <div class="match-percent">{{ match.result_compatibility }}%</div>
                        </div>
                    </div>
                
                    <div class="match-goal"><span class="goal">{{ match.searching }}</span></div>
                </div>
            {% endfor %}
        </div>

        <footer>
            <div class="footer-container">
                <div id="profile" class="footer-item"><img src="/static/img/icon_profile.png" alt="Профиль" /></div>
                <div id="love_in_me" class="footer-item"><img src="/static/img/icon_love.png" alt="Любовь" /></div>
                <div id="match" class="footer-item"><div class="footer-active"><img src="/static/img/icon_match.png" alt="Мэтчи" /><span>Мэтчи</span></div></div>
                <div id="speedometr" class="footer-item"><img src="/static/img/icon_speedometr.png" alt="Спидометр" /></div>
                <div id="payment" class="footer-item"><img src="/static/img/icon_tarif.png" alt="Тарифы" /></div>
            </div>
        </footer>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const matchesContainer = document.getElementById('matches-container');
                const tabsContainer = document.getElementById('tabs');
    
                const matches = Array.from(document.querySelectorAll('.table-match.match-card'));
                
                const tabNamesMap = {
                    "новый": "новые",
                    "просмотрено": "просмотрено",
                    "ожидание ответа": "ожидание",
                    "мэтч": "мэтч",
                    "нет мэтча": "отказ"
                };

                // Извлекаем статусы и группируем матчи по ним
                const statusMap = {};
    
                matches.forEach(match => {
                    const statusEl = match.querySelector('.status');
                    if (!statusEl) return;
                    const status = statusEl.textContent.trim();
    
                    if (!statusMap[status]) {
                        statusMap[status] = [];
                    }
                    statusMap[status].push(match);
                });
    
                const statuses = Object.keys(statusMap);

                const newIndex = statuses.indexOf('новый');
                if (newIndex > 0) {
                    statuses.splice(newIndex, 1);
                    statuses.unshift('новый');
                }

                let activeStatus = statuses.includes('новый') ? 'новый' : (statuses[0] || null);
    
                // Функция рендера матча для выбранного статуса
                function renderMatches(status) {
                    matchesContainer.innerHTML = ''; // очистить
    
                    if (!statusMap[status] || statusMap[status].length === 0) {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.style.textAlign = 'center';
                        emptyMessage.style.padding = '20px';
                        emptyMessage.style.color = '#d880d1';
                        emptyMessage.style.fontSize = '16px';
                        emptyMessage.textContent = '{{ state }}';
                        matchesContainer.appendChild(emptyMessage);
                        return;
                    }
    
                    statusMap[status].forEach(match => {
                        matchesContainer.appendChild(match);
                    });
                }
    
                // Функция создания вкладок и их обработчиков
                function createTabs() {
                    tabsContainer.innerHTML = '';
                    statuses.forEach(status => {
                        const tab = document.createElement('button');
                        const tabLabel = tabNamesMap[status] || status;
                        tab.textContent = tabLabel;

                        tab.style.padding = '8px 12px';
                        tab.style.borderRadius = '18px';
                        tab.style.border = 'none';
                        tab.style.cursor = 'pointer';
                        tab.style.background = status === activeStatus ? '#9455be' : '#4a2a63';
                        tab.style.color = '#d2ccff';
                        // tab.style.fontWeight = status === activeStatus ? '700' : '500';
                        tab.style.fontFamily = "'Open Sans', sans-serif";
                        tab.style.fontSize = '14px';
                        tab.style.whiteSpace = 'nowrap';
    
                        tab.addEventListener('click', () => {
                            if (activeStatus === status) return;
                            activeStatus = status;
                            renderMatches(activeStatus);
                            createTabs();
                        });
    
                        tabsContainer.appendChild(tab);
                    });
                }
    
                // Инициализация
                createTabs();
                renderMatches(activeStatus);
            });
        </script>
        <!--<script src="https://cdn.jsdelivr.net/npm/eruda"></script>-->
        <!--<script>eruda.init();</script>-->
        <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
        <script src="/static/js/menu_control.js?v=1.0.0"></script>
        <script src="/static/js/match_control.js?v=1.0.0"></script>
    </body>
</html>
